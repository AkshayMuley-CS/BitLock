<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Secure Encrypt/Decrypt ‚Ä¢ AES‚ÄëGCM ‚Ä¢ Client‚ÄëOnly</title>
  <style>
    :root{
      --bg:#0b0f17;--panel:#121826;--muted:#1b2334;--text:#e6ebff;--sub:#94a3b8;--acc:#7c5cff;--acc2:#22d3ee;--red:#ef4444;--green:#22c55e
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:radial-gradient(1200px 600px at 90% -10%,rgba(124,92,255,.15),transparent),
                radial-gradient(1000px 800px at -20% 120%,rgba(34,211,238,.12),transparent),var(--bg);
         color:var(--text);font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif}
    .wrap{max-width:1000px;margin:40px auto;padding:24px}
    header{display:flex;align-items:center;justify-content:space-between;gap:16px;margin-bottom:24px}
    .title{font-weight:800;font-size:clamp(20px,3.2vw,32px);letter-spacing:.3px}
    .badge{display:inline-flex;align-items:center;gap:8px;background:linear-gradient(145deg,var(--muted),#0d1320);border:1px solid #20283b;color:#c7d2fe;padding:6px 10px;border-radius:999px;font-size:12px}
    .grid{display:grid;grid-template-columns:1fr;gap:16px}
    @media(min-width:980px){.grid{grid-template-columns:1.1fr .9fr}}
    .card{background:linear-gradient(180deg,rgba(255,255,255,.02),rgba(255,255,255,.0));border:1px solid #1f2940;border-radius:18px;padding:18px;box-shadow:0 10px 30px rgba(0,0,0,.25)}
    .card h3{margin:0 0 8px;font-size:18px}
    textarea{width:100%;min-height:140px;background:#0c1220;border:1px solid #1c253d;border-radius:14px;color:var(--text);padding:12px;resize:vertical}
    .row{display:flex;gap:10px;flex-wrap:wrap}
    .btn{appearance:none;border:1px solid #2a3553;background:linear-gradient(180deg,#1b2540,#141b2d);color:white;padding:10px 14px;border-radius:12px;cursor:pointer;font-weight:600;transition:.18s transform,.18s border-color}
    .btn:hover{transform:translateY(-1px);border-color:#3c4b72}
    .btn.acc{background:linear-gradient(135deg,var(--acc),#5c3cff);border:none}
    .btn.ghost{background:transparent}
    .btn.warn{background:linear-gradient(135deg,#ef4444,#b91c1c);border:none}
    .btn.ok{background:linear-gradient(135deg,#22c55e,#15803d);border:none}
    input[type="password"],input[type="text"],input[type="number"]{width:100%;background:#0c1220;border:1px solid #1c253d;border-radius:12px;color:var(--text);padding:10px}
    .hint{font-size:12px;color:var(--sub)}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace}
    .pill{display:inline-block;padding:.2rem .6rem;border-radius:999px;background:#0e1526;border:1px solid #20283b;color:#cbd5e1;font-size:12px}
    .footer{opacity:.8;font-size:12px;margin-top:10px}
    .hr{height:1px;background:linear-gradient(90deg,transparent,#26314d,transparent);margin:10px 0}
    .out{min-height:100px;background:#0a101e;border:1px dashed #26314d;border-radius:12px;padding:10px;overflow:auto}
    .filebox{border:1px dashed #334155;border-radius:12px;padding:12px;background:#0b1120}
    .filebox input{display:block;margin-top:8px}
    .kvs{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    @media(max-width:620px){.kvs{grid-template-columns:1fr}}
    .small{font-size:12px}
    .label{font-size:12px;color:#94a3b8;margin-bottom:6px}
    .tagline{color:#a5b4fc}
    .switch{display:flex;align-items:center;gap:8px}
    .switch input{accent-color:#7c5cff}
    .center{display:flex;align-items:center;justify-content:center}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <div class="title">üîê Secure Encrypt/Decrypt (AES‚ÄëGCM, Client‚ÄëOnly)</div>
        <div class="tagline">No server. Uses Web Crypto API in your browser. Salted PBKDF2 ‚Üí AES‚ÄëGCM with random IV.</div>
      </div>
      <div class="badge"><span>v1.0</span><span class="pill mono">1.0.0</span></div>
    </header>

    <div class="grid">
      <!-- Left: Text mode -->
      <section class="card">
        <h3>Text Encryption</h3>
        <div class="kvs">
          <div>
            <div class="label">Passphrase</div>
            <input id="pass" type="password" placeholder="Enter strong passphrase" autocomplete="new-password" />
          </div>
          <div>
            <div class="label">Iterations (PBKDF2)</div>
            <input id="iters" type="number" min="10000" step="1000" value="250000" />
          </div>
        </div>
        <div class="row" style="margin-top:10px">
          <label class="switch"><input id="showPass" type="checkbox"/> Show passphrase</label>
          <label class="switch"><input id="compatJson" type="checkbox" checked/> JSON package output</label>
        </div>
        <div class="hr"></div>
        <div class="label">Plaintext</div>
        <textarea id="plain" class="mono" placeholder="Type text to encrypt‚Ä¶"></textarea>
        <div class="row" style="margin-top:10px">
          <button class="btn acc" id="btnEncText">Encrypt Text</button>
          <button class="btn ok" id="btnDecText">Decrypt Text</button>
          <button class="btn ghost" id="btnClear">Clear</button>
        </div>
        <div class="hr"></div>
        <div class="label">Output</div>
        <div class="out small mono" id="out"></div>
        <div class="row" style="margin-top:10px">
          <button class="btn" id="btnCopy">Copy Output</button>
          <button class="btn" id="btnDownloadJson">Download Output (.json)</button>
        </div>
        <div class="footer">Format: <span class="mono">{ v, alg:"AES-GCM", salt, iv, iters, ct }</span> ‚Äî base64 fields.</div>
      </section>

      <!-- Right: File mode -->
      <section class="card">
        <h3>File Encryption</h3>
        <div class="filebox">
          <div class="label">Select file</div>
          <input id="file" type="file" />
        </div>
        <div class="kvs" style="margin-top:10px">
          <div>
            <div class="label">Passphrase</div>
            <input id="fpass" type="password" placeholder="Enter strong passphrase" autocomplete="new-password" />
          </div>
          <div>
            <div class="label">Iterations (PBKDF2)</div>
            <input id="fiters" type="number" min="10000" step="1000" value="250000" />
          </div>
        </div>
        <div class="row" style="margin-top:10px">
          <button class="btn acc" id="btnEncFile">Encrypt File</button>
          <button class="btn ok" id="btnDecFile">Decrypt File (.json)</button>
        </div>
        <div id="fstatus" class="hint" style="margin-top:8px"></div>
        <div class="footer">Encrypted file is saved as JSON package (<span class="mono">.secure.json</span>). Decrypt by selecting the JSON and entering the same passphrase.</div>
      </section>
    </div>

    <section class="card" style="margin-top:16px">
      <h3>Security Notes</h3>
      <ul>
        <li>Uses <span class="mono">window.crypto.subtle</span> with <strong>AES‚ÄëGCM 256‚Äëbit</strong>, random 96‚Äëbit IV, and <strong>PBKDF2‚ÄëSHA‚Äë256</strong> key derivation with a random 128‚Äëbit salt.</li>
        <li>Everything runs entirely in your browser ‚Äî nothing leaves your device.</li>
        <li>JSON package contains all parameters needed for decryption (except your passphrase). Keep your passphrase safe.</li>
        <li>Set iterations higher for more resistance against brute‚Äëforce (defaults to 250k ‚Äî adjust to your device performance).</li>
      </ul>
    </section>

    <section class="center" style="margin-top:10px">
      <span class="small">¬© 2025 Akshay Muley ‚Ä¢ Licensed ‚Ä¢ No commercial use without permission. No derivatives.</span>
    </section>
  </div>

<script>
// ===== Helpers =====
const enc = new TextEncoder();
const dec = new TextDecoder();
const b64 = {
  to: buf => btoa(String.fromCharCode(...new Uint8Array(buf))),
  from: str => Uint8Array.from(atob(str), c => c.charCodeAt(0)).buffer
};

function randBytes(len){
  const a = new Uint8Array(len);
  crypto.getRandomValues(a);
  return a;
}

async function deriveKey(pass, salt, iters){
  const keyMat = await crypto.subtle.importKey(
    'raw', enc.encode(pass), {name:'PBKDF2'}, false, ['deriveKey']
  );
  return crypto.subtle.deriveKey(
    {name:'PBKDF2', hash:'SHA-256', salt, iterations: iters},
    keyMat,
    {name:'AES-GCM', length:256},
    false,
    ['encrypt','decrypt']
  );
}

async function encryptBytes(bytes, pass, iters){
  const salt = randBytes(16); // 128-bit
  const iv = randBytes(12);   // 96-bit for GCM
  const key = await deriveKey(pass, salt, iters);
  const ct = await crypto.subtle.encrypt({name:'AES-GCM', iv}, key, bytes);
  return { v:1, alg:'AES-GCM', iters, salt:b64.to(salt), iv:b64.to(iv), ct:b64.to(ct) };
}

async function decryptToBytes(pkg, pass){
  const salt = b64.from(pkg.salt);
  const iv = b64.from(pkg.iv);
  const iters = pkg.iters|0;
  const key = await deriveKey(pass, new Uint8Array(salt), iters);
  const ct = b64.from(pkg.ct);
  try{
    const pt = await crypto.subtle.decrypt({name:'AES-GCM', iv:new Uint8Array(iv)}, key, ct);
    return pt;
  }catch(e){
    throw new Error('Decryption failed. Wrong passphrase or corrupted data.');
  }
}

// ===== UI Wiring (Text) =====
const $ = sel => document.querySelector(sel);
const passEl = $('#pass');
const itersEl = $('#iters');
const showPass = $('#showPass');
const outEl = $('#out');
const compatJson = $('#compatJson');

showPass.addEventListener('change',()=>{
  passEl.type = showPass.checked ? 'text' : 'password';
  $('#fpass').type = showPass.checked ? 'text' : 'password';
});

$('#btnClear').onclick = ()=>{ $('#plain').value=''; outEl.textContent=''; };

$('#btnEncText').onclick = async ()=>{
  const pass = passEl.value;
  const iters = parseInt(itersEl.value)||250000;
  const text = $('#plain').value||'';
  if(!pass){ alert('Enter a passphrase.'); return; }
  const pkg = await encryptBytes(enc.encode(text), pass, iters);
  outEl.textContent = JSON.stringify(pkg,null,2);
};

$('#btnDecText').onclick = async ()=>{
  const pass = passEl.value;
  if(!pass){ alert('Enter a passphrase.'); return; }
  let pkg;
  try{
    pkg = JSON.parse(outEl.textContent.trim());
  }catch(e){
    alert('Output is not valid JSON package.'); return;
  }
  try{
    const pt = await decryptToBytes(pkg, pass);
    $('#plain').value = dec.decode(pt);
  }catch(e){ alert(e.message); }
};

$('#btnCopy').onclick = async ()=>{
  if(!outEl.textContent){ return; }
  await navigator.clipboard.writeText(outEl.textContent);
  flash('Copied output to clipboard');
};

$('#btnDownloadJson').onclick = ()=>{
  if(!outEl.textContent) return;
  const blob = new Blob([outEl.textContent], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = 'encrypted.secure.json'; a.click();
  URL.revokeObjectURL(url);
};

// ===== File Mode =====
const fileEl = $('#file');
const fpassEl = $('#fpass');
const fitersEl = $('#fiters');
const fstatus = $('#fstatus');

$('#btnEncFile').onclick = async ()=>{
  const f = fileEl.files?.[0];
  if(!f){ alert('Choose a file first.'); return; }
  const pass = fpassEl.value; if(!pass){ alert('Enter a passphrase.'); return; }
  const iters = parseInt(fitersEl.value)||250000;
  const buf = await f.arrayBuffer();
  fstatus.textContent = 'Encrypting‚Ä¶';
  const pkg = await encryptBytes(buf, pass, iters);
  const json = JSON.stringify({ filename:f.name, ...pkg }, null, 2);
  const blob = new Blob([json], {type:'application/json'});
  const a = document.createElement('a');
  const url = URL.createObjectURL(blob);
  a.href = url; a.download = f.name + '.secure.json'; a.click();
  URL.revokeObjectURL(url);
  fstatus.textContent = 'Done. Saved ' + a.download;
};

$('#btnDecFile').onclick = async ()=>{
  const f = fileEl.files?.[0];
  if(!f){ alert('Select the .secure.json file produced earlier.'); return; }
  const pass = fpassEl.value; if(!pass){ alert('Enter a passphrase.'); return; }
  try{
    const text = await f.text();
    const pkg = JSON.parse(text);
    if(pkg.alg!=='AES-GCM'){ throw new Error('Unsupported package'); }
    fstatus.textContent = 'Decrypting‚Ä¶';
    const pt = await decryptToBytes(pkg, pass);
    const outName = (pkg.filename||'decrypted.bin');
    const blob = new Blob([pt]);
    const a = document.createElement('a');
    const url = URL.createObjectURL(blob);
    a.href = url; a.download = outName.replace(/\.secure\.json$/,''); a.click();
    URL.revokeObjectURL(url);
    fstatus.textContent = 'Done. Saved ' + a.download;
  }catch(e){
    console.error(e);
    alert(e.message||'Failed to decrypt');
    fstatus.textContent = '';
  }
};

function flash(msg){
  const d = document.createElement('div');
  d.textContent = msg;
  d.style.cssText = 'position:fixed;bottom:18px;left:50%;transform:translateX(-50%);background:#111827;border:1px solid #243049;padding:10px 14px;border-radius:10px;box-shadow:0 10px 30px rgba(0,0,0,.35);z-index:9999;opacity:0;transition:.25s';
  document.body.appendChild(d);
  requestAnimationFrame(()=>{ d.style.opacity=1; });
  setTimeout(()=>{ d.style.opacity=0; setTimeout(()=>d.remove(),250); }, 1400);
}
</script>
</body>
</html>
